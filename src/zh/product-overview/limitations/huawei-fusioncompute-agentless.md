# Huawei FusionCompute无代理模式

::: warning
在使用FusionCompute无代理模式时，要求每一台客户机(Guest OS)必须安装并启动Tools，否则无法启用无代理模式。
:::

## 兼容性

| 模块                | 版本   |
|---------------------|--------|
| FusionCompute       | 8.6.0  |
| FusionCompute VRM接口 | 8.6.0  |

## 客户机操作系统支持

点击[云平台支持矩阵](https://oneprocloud.feishu.cn/sheets/VRqksSPEPhRTPStp3kVcItXNnyh?sheet=Y9fpqO)查看兼容性列表及最新支持状态。

## 支持与限制

### **1. 基本要求与限制**

- **虚拟机工具与状态要求**

  在为主机创建CBT快照之前，虚拟机必须安装并启动虚拟机工具。这是确保能够正确生成CBT快照的必要条件。

- **虚拟机状态要求**

  - 在虚拟机处于**休眠状态**时，仅支持创建内存快照。
  - 在虚拟机处于**关闭状态**时，仅可生成普通快照，无法创建CBT快照。
  - 在虚拟机处于**非运行、非休眠、非停止**状态时，不允许创建任何类型的快照。

- **虚拟机磁盘要求**

  - 虚拟机挂载的磁盘总线类型为**IDE**时，无法创建快照。
  - 使用**共享磁盘**的虚拟机，不支持创建快照。如果虚拟机正在使用共享磁盘，则无法执行任何类型的快照操作。
  - **独立磁盘**无法备份。

- **快照数量限制**

  每个虚拟机最多支持创建**32个备份快照**。超过此数量后，无法再创建新的快照。

- **架构限制**

  绑定共享磁盘的**x86架构虚拟机**不支持创建内存快照或一致性快照。当创建普通快照时，**共享磁盘**不会被纳入快照范围。

### **2. 备份与恢复操作相关限制**

- **虚拟机状态与操作互斥**

  在备份操作期间，必须避免虚拟机进行以下操作：启动、在线绑定磁盘、关闭、磁盘扩容、存储迁移、整机迁移等。所有这些操作与备份任务互斥，必须在备份完成后执行。

- **备份失败风险**

  在备份过程中，虚拟机关机或进行状态变更（如HA重启、恢复虚拟机快照、卷扩容等操作）会导致备份失败。同时，**CBT快照失效**，需要重新进行全量备份。

- **虚拟机备份场景限制**

  - 在执行存储迁移、磁盘扩容等操作时，快照功能无法使用。
  - 不支持对**链接克隆虚拟机**和**模板虚拟机**进行快照。
  - 当快照数量超出最大限制时，无法继续创建快照。

- **存储与资源分配要求**

  在进行虚拟机备份时，可能需要在目标存储上进行快照合并操作。因此，目标存储上需要预留足够的空间用于快照合并。每次eBackup最多支持在目标存储上同时备份**8个卷**，即最多需要8个合并后快照的空间。

- **存储IO性能影响**

  由于备份和恢复过程中涉及对存储进行读写操作，因此会对存储的IO性能造成一定影响。建议选择**业务空闲时间**进行备份恢复，以减少对业务正常运行的影响。

- **跨存储类型备份限制**

  不支持跨存储类型的备份恢复。例如，虚拟化存储与FusionStorage存储之间不能互相进行备份和恢复操作。

### **3. 资源控制与性能影响**

- **资源分配与连接限制**

  在备份过程中，调用**VRM接口**准备备份资源时，VRM会进行资源分配和控制。每台主机最多支持同时开启**8个Socket连接**，进行备份操作。

- **系统与存储类型兼容性**

  一致性快照和内存快照仅支持在**EulerOS**系统环境下使用，其他系统类型不支持该功能。

- **磁盘存储类型要求**

  仅当虚拟机的磁盘存储类型为以下之一时，才支持快照功能：
  - 分布式块存储
  - eVol存储
  - 虚拟化本地硬盘
  - 虚拟化SAN存储
  - NAS存储

- **虚拟机暂停时间**

  在eBackup备份场景中，如果虚拟机配置了**10个200GB的虚拟化类型磁盘**，其暂停时间通常在**1到3秒**之间。暂停时间将受到虚拟磁盘大小、磁盘读写速度、CPU性能等因素的影响。在性能较差的主机或存储环境下，暂停时间可能会超过3秒。
